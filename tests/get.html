<!DOCTYPE html>
<html lang="en" class="p-0 m-0">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover, user-scalable=no, minimal-ui, maximum-scale=1.0, minimum-scale=1.0" />
    <title>Get test</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,container-queries"></script>
  </head>
  <body
    class="bg-gray-100 text-gray-900 font-sans text-[21px] flex flex-col items-stretch justify-center min-h-dvh">
    <div
      class="flex flex-col items-stretch justify-start gap-md p-[21px] mx-auto md:w-[768px] bg-white rounded-md shadow-xl border-gray-300">
      <h1 class="text-lg">Test fab-analytics api get</h1>

      <form id="domain">
        <label for="name">Name</label>
        <input
          type="text"
          name="name"
          id="name"
          required
          class="w-full rounded-md border-gray-300 p-md text-lg border-1"
          placeholder="(required) Your Actual Real Name" />

        <button
          type="submit"
          class="rounded-md bg-blue-500 px-[42px] py-[11px] text-white">
          Submit
        </button>
      </form>

      <div id="results-wrapper">
        <h2>Results</h2>
        <div id="results" class="divide-y-1 divide-gray-300"></div>
      </div>
    </div>

    <template id="result-item-template">
      <div class="result-item p-[21px]" data-domain="" data-year="" data-month="" data-day="" data-event="">
        <h2 class="domain text-4xl"></h2>
        <h3 class="year text-3xl"></h3>
        <h4 class="month text-2xl"></h4>
        <h5 class="day text-xl"></h5>
        <h6 class="event text-lg"></h6>
        <p>
          <strong class="visitor"></strong>

          <dl class="dimensions">
            <dt class="dimension-name"></dt>
            <dd class="dimension-value"></dd>
          </dl>
        </p>
      </div>
    </template>

    <script>
      const form = document.getElementById("domain");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const name = form.getElementById("name").value;

        fetch(`/fab-analytics/api/get?domain=${name}`)
          .then((response) => {
            //console.log(response);
            //console.log(response.json());
            //console.log(response.text());
            return response.json();
          })
          .then((data) => {
            const results = document.getElementById("results");

            results.innerHTML = "";

            Object.keys(data).forEach((year) => {
              const yearElement = document.createElement("h3");
              yearElement.innerHTML = year;

              results.appendChild(yearElement);

              Object.keys(data[year]).forEach((month) => {
                const monthElement = document.createElement("h4");
                monthElement.innerHTML = month;

                results.appendChild(monthElement);

                Object.keys(data[year][month]).forEach((day) => {
                  const dayElement = document.createElement("h5");
                  dayElement.innerHTML = day;

                  results.appendChild(dayElement);

                  Object.keys(data[year][month][day]).forEach((event) => {
                    const eventElement = document.createElement("h6");
                    eventElement.innerHTML = event;

                    results.appendChild(eventElement);

                    Object.keys(data[year][month][day][event]).forEach(
                      (token) => {
                        const tokenElement = document.createElement("h6");
                        tokenElement.innerHTML = token;

                        results.appendChild(tokenElement);
                      }
                    );
                  });
                });
              });
            });
          });
      });

      document.addEventListener("DOMContentLoaded", () => {
        fetch(`/fab-analytics/api/get/`)
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          const results = document.getElementById("results");

          results.innerHTML = "";

          const resultItemTemplate = document.getElementById("result-item-template");

          Object.keys(data).forEach((domain) => {
            const domainElement = resultItemTemplate.content.cloneNode(true);
            domainElement.querySelector(".domain").innerHTML = domain;

            Object.keys(data.domain.year.month.day.event.token).forEach((visitor) => {
              domainElement.querySelector(".year").innerHTML = data.domain.year;
              domainElement.querySelector(".month").innerHTML = data.domain.month;
              domainElement.querySelector(".day").innerHTML = data.domain.day;
              domainElement.querySelector(".event").innerHTML = data.domain.event;
              domainElement.querySelector(".visitor").innerHTML = visitor;
            });
        });
      });
      });
    </script>
  </body>
</html>
